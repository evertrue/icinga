# Automatically check each host for new inventory items
inventory_check_interval = 120

# Adjust our HARD check attempts and retry intervals
extra_host_conf["max_check_attempts"] = [ ("5", ALL_HOSTS) ]
extra_service_conf["max_check_attempts"] = [ ("5", ALL_HOSTS, [""]) ]
extra_host_conf["retry_interval"] = [ ("1", ALL_HOSTS) ]
extra_service_conf["retry_interval"] = [ ("1", ALL_HOSTS, [""]) ]

# Automatically create host- and servicegroups
define_hostgroups = True
define_servicegroups = True
define_contactgroups = True

# Use alias for names and monitor interface speeds
if_inventory_uses_alias = True
if_inventory_monitor_speed = True

# Global filesystem default levels
filesystem_default_levels["levels"] = ( 90, 95 )

# Ignore ipmi entries with no records
ipmi_ignore_nr = True

# Adjust some check parameters
check_parameters += [
    # /boot is usually pretty small and doesn't change often
    ( { "levels" : (95, 98)} , ALL_HOSTS, [ "fs_/boot" ] ),
]

# Ignore some services
ignored_services += [
    # Disable some monitoring events that are causing false positives
    ( ALL_HOSTS, [ "Monitoring" ] ),
    ( ALL_HOSTS, [ 'NFS mount /var/userhome/.*' ] ),
    # These often deliver false positives
    ( ALL_HOSTS, [ "IPMI Sensor Fan_Fan4" ] ),
    ( ALL_HOSTS, [ "IPMI Sensor Fan_Fan5" ] ),
    ( ALL_HOSTS, [ "IPMI Sensor Fan_Fan6" ] ),
    ( ALL_HOSTS, [ "IPMI Sensor Fan_Fan7/CPU1" ] ),
    ( ALL_HOSTS, [ "IPMI Sensor Fan_Fan8/CPU2" ] ),
    ( ALL_HOSTS, [ "MySQL DB .* Size" ] ),

    # Ignore interfaces on network devices that have no string alias/description set
    ( ["switch"], ALL_HOSTS, ["Interface\s\d+"]),
    ( ["router"], ALL_HOSTS, ["Interface\s\d+"]),
]

# Our SNMP default community for SNMP scans
snmp_default_community = "phN7RY5s163nE"

inventory_processes += [
    # System processes
    ( "NTPD", "/usr/sbin/ntpd", ANY_USER, 1, 1, 1, 1),
    ( "SSH", "/usr/sbin/sshd", ANY_USER, 1, 1, 5, 6),
    ( "rsyslogd", "/usr/sbin/rsyslogd", "syslog", 1, 1, 1, 1),
    # Services
    ( "Memcached", "/usr/bin/memcached", "nobody", 1, 1, 1, 1),
]

inventory_processes_perf += [
    # Services
    ( "Apache2", "~.*bin/apache2", "www-data", 2, 3, 50, 50 ),
    ( "nginx_Master", "~nginx: master process /usr/sbin/nginx", "root", 1, 1, 1, 1),
    ( "nginx_Worker", "~nginx: worker process", "www-data", 0, 1, 15, 20),
    ( "Jetty", "~/usr/bin/java.*/opt/jetty/start.jar", "jetty", 1, 1, 1, 1),
    ( "Jenkins", "~/usr/bin/java.*/usr/share/jenkins/jenkins.war", "jenkins", 0, 1, 15, 30),
]


service_groups += [
    ( "Filesystems", ALL_HOSTS, [ "fs" ] ),
    ( "Performance", ALL_HOSTS, [
        "CPU load",
        "CPU utilization",
        "Disk IO SUMMARY",
        "Interface.*",
        "Memory used" ] ),
    ( "Heartbeat", ALL_HOSTS, [ "Heartbeat.*" ] ),
    ( "MySQL", ALL_HOSTS, [ "MySQL.*" ] ),
    ( "Apache", ALL_HOSTS, [ "proc_Apache2" ] ),
    ( "Logfiles", ALL_HOSTS, [ "LOG.*" ] ),
    ( "IPMI", ALL_HOSTS, [ "IPMI.*" ] ),
    ( "RAID", ALL_HOSTS, [ "RAID.*", "MD.*" ] ),
    ( "Processes", ALL_HOSTS, [ "proc_.*" ] ),
]
